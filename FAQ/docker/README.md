# DOCker

## 1. Что такое Docker и зачем он нужен?

**Простая аналогия:**
Представьте, что вы переезжаете в новую квартиру. Без Docker:
- Вам нужно заново настраивать интернет, телевизор, собирать мебель
- Что-то может не работать из-за разных розеток или настроек

С Docker:
- Вы перевозите готовые комнаты со всей мебелью и настройками
- Вставляете их в новую квартиру - всё работает сразу!

**Что такое Docker на самом деле:**
Docker — это способ упаковать ваше приложение со всеми его "деталями" (библиотеками, настройками) в одну коробку-контейнер. Эта коробка будет работать одинаково на любом компьютере.

## 2. Чем контейнер отличается от виртуальной машины?

**Виртуальная машина** - как отдельная квартира в доме:
- Имеет свои стены, свою кухню, свою ванную
- Занимает много места
- Требует много ресурсов

**Docker контейнер** - как комната в квартире:
- Использует общую кухню и ванную (ядро операционной системы)
- Занимает мало места
- Запускается за секунды

## 3. Основные понятия, которые нужно знать

**Образ (Image)** - чертеж или рецепт
- Содержит инструкции для создания контейнера
- Можно скачать готовые образы или создать свои

**Контейнер (Container)** - готовое блюдо по рецепту
- Запущенная версия образа
- Изолированное окружение, где работает приложение

**Dockerfile** - подробный рецепт
- Текстовый файл с инструкциями по сборке образа

**Docker Compose** - меню комплексного обеда
- Позволяет запускать несколько связанных контейнеров вместе

## 4. Установка Docker

### Для Windows/macOS:
1. Зайдите на сайт docker.com
2. Скачайте Docker Desktop
3. Установите как обычную программу
4. Запустите и подождите, пока появится значок Docker в системном трее

### Для Linux (Ubuntu/Debian):
Откройте терминал и выполните команды:
```bash
sudo apt update
sudo apt install docker.io
sudo systemctl start docker
sudo systemctl enable docker
```

## 5. Разбираем docker-compose.yml

```yaml
services:
  
  postgres:
    image: postgres:15-alpine
    container_name: postgres_db
    environment:
      POSTGRES_DB: car_db
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d postgres"]
      interval: 5s
      timeout: 5s
      retries: 5
      
  app:
    build: .
    container_name: car_app
    environment:
      SPRING_DATASOURCE_URL: jdbc:postgresql://postgres:5432/car_db
      SPRING_DATASOURCE_USERNAME: postgres
      SPRING_DATASOURCE_PASSWORD: postgres
      SPRING_JPA_HIBERNATE_DDL_AUTO: update
    ports:
      - "8080:8080"
    depends_on:
      postgres:
        condition: service_healthy
```

Давайте разберем файл для бд по частям:

```yaml
services:          # Здесь мы перечисляем все сервисы (контейнеры)
  postgres:        # Называем наш сервис "postgres"
    image: postgres:15-alpine    # Используем образ PostgreSQL
```

**Что такое образ?**
- `postgres:15-alpine` - это готовый образ базы данных PostgreSQL
- `15` - версия PostgreSQL
- `alpine` - легкая версия Linux (занимает мало места)

```yaml
    container_name: postgres_db    # Даем имя нашему контейнеру
    environment:                   # Настройки для базы данных
      POSTGRES_DB: car_db         # Создаем базу с именем car_db
      POSTGRES_USER: postgres     # Имя пользователя
      POSTGRES_PASSWORD: postgres # Пароль
```

**Зачем нужны environment?**
- Это настройки, которые передаются в контейнер при запуске
- Как параметры установки программы

```yaml
    volumes:      # Сохранение данных
      - postgres_data:/var/lib/postgresql/data
```

**Зачем нужны volumes?**
- Без volumes все данные в базе исчезнут при выключении контейнера
- Volumes сохраняют данные на вашем компьютере
- Это как сохранить документы на флешку, а не на рабочий стол

```yaml
    ports:        # Открываем порты для доступа
      - "5432:5432"
```

**Что делают ports?**
- `"5432:5432"` означает: порт 5432 на вашем компьютере соединяется с портом 5432 в контейнере
- Теперь вы можете подключиться к базе через localhost:5432

```yaml
    healthcheck:    # Проверка, что база работает
      test: ["CMD-SHELL", "pg_isready -U postgres -d postgres"]
      interval: 5s  # Проверять каждые 5 секунд
```

## 6. Dockerfile

Dockerfile - это инструкция по созданию образа вашего приложения:

```dockerfile
# Первый этап - сборка приложения
FROM gradle:8.7-jdk21 AS build   # Берем образ с инструментами сборки
WORKDIR /app                     # Создаем рабочую папку
COPY . .                         # Копируем файлы проекта
RUN gradle build -x test         # Собираем приложение

# Второй этап - создание финального образа
FROM openjdk:21-jdk-slim        # Берем легкий образ только с Java
COPY --from=build /app/build/libs/*.jar app.jar  # Копируем собранное приложение
CMD ["java", "-jar", "app.jar"] # Команда для запуска
```

**Зачем два этапа?**
- Первый этап: собираем приложение (нужны инструменты сборки)
- Второй этап: запускаем приложение (нужен только Java)
- Это делает итоговый образ меньше и безопаснее

## 7. Как запустить вашу базу данных

**Шаг 1:** Откройте терминал в папке, где лежит `docker-compose.yml`

**Шаг 2:** Выполните команду:
```bash
docker-compose up -d
```

**Что произойдет:**
- Docker скачает образ PostgreSQL (если его еще нет)
- Создаст контейнер с базой данных
- Запустит базу в фоновом режиме
- База будет доступна на localhost:5432

**Шаг 3:** Проверьте, что всё работает:
```bash
docker ps
```
Вы должны увидеть запущенный контейнер `postgres_db`

## 8. Полезные команды для работы

```bash
# Посмотреть все запущенные контейнеры
docker ps

# Посмотреть все контейнеры (включая остановленные)
docker ps -a

# Остановить контейнер
docker stop имя_контейнера

# Посмотреть логи (что происходит внутри контейнера)
docker logs имя_контейнера

# Зайти внутрь контейнера (как в терминал)
docker exec -it имя_контейнера bash

# Остановить все запущенные контейнеры
docker-compose down
```

## 9. Частые проблемы и их решение

**Проблема:** "Порт 5432 уже используется"
**Решение:**
- Или остановите другие программы, использующие этот порт
- Или измените порт в docker-compose.yml на "5433:5432"

**Проблема:** "Permission denied" (на Linux)
**Решение:** Выполните команду:
```bash
sudo usermod -aG docker $USER
```
И перезайдите в систему

**Проблема:** Контейнер не запускается
**Решение:** Посмотрите логи:
```bash
docker logs имя_контейнера
```

## 10. Что делать, если что-то пошло не так?

1. **Не паникуйте!** Ошибки - это нормально
2. **Читайте сообщения об ошибках** - они часто подсказывают решение
3. **Используйте Google** - почти на каждую ошибку уже есть решение
4. **Проверьте логи** - `docker logs` покажет, что происходит внутри контейнера