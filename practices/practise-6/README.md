# Занятие 6. Поведенческие паттерны

## Цель занятия
Реализовать автоматическую систему учета продаж с использованием паттерна **Наблюдатель** (Observer).

## Задание
Модифицировать систему продаж так, чтобы все операции автоматически фиксировались в отчете.

## Основные требования

### 1. Реализация паттерна Наблюдатель
Нужно сделать добавление записей в отчет прямо во время продажи. Для этого и используем паттерн наблюдатель.

**Для наблюдателей:**
- Создайте интерфейс `SalesObserver` с методом `onSale()`
- Реализуйте класс `ReportSalesObserver` для записи в отчет
- Регистрируйте наблюдателя в системе продаж

**В классах продаж:**
- Добавьте механизм подписки наблюдателей (`addObserver()`)
- Реализуйте оповещение наблюдателей при продаже (`notifyObserversOnSale()`)
- Вызывайте оповещение в методах продажи автомобилей и катамаранов

### 2. Использование АОП для отслеживания операций
Нужно сделать так, чтобы до и после продажи, в отчет автоматически добавлялась информация о покупателях и их состоянии

**Настройка:**
- Добавьте Spring AOP в зависимости проекта //нужно добавить в build gradle, снизу ссылка на mavenCentral
- Создайте аннотацию `@Sales` для пометки методов продаж
- Реализуйте аспект `SalesAspect` для обработки аннотации

**Функциональность аспекта:**
- Автоматическая проверка состояния данных до/после операции
- Логирование операций продаж

### 3. Доп задание
Задание для тех кому прошлые показались легкими или хочет чуть больше узнать: 
напишите юнит тесты на аннотацию, это сильно прокачает понимание и аспектов и тестов, 
и в целом это не тривиальная задача все правильно поднять.

## Техническая реализация

### Классы и методы для реализации:

**В системе продаж:**
```java
// Добавьте эти методы в классы продаж
void addObserver(SalesObserver observer);
void notifyObserversOnSale(Customer customer, ProductType type, int vin);

//а так же не забудьте про список самих наблюдателей
final List<SalesObserver> observers = new ArrayList<>();
```

**Для наблюдателя:**
```java
interface SalesObserver {
    void onSale(Customer customer, ProductType type, int vin);
}

class ReportSalesObserver implements SalesObserver {
    void onSale(Customer customer, ProductType type, int vin);
    Report generateReport();
}
```

**Для АОП:**
```java
//Создайте аннотацию Sales, чтобы можно было не дублировать код в классах
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.METHOD)
public @interface Sales {
    String value() default "";
}

// Каждая аннотация имеет свою реализацию, для этого существует понятие аспект (реализация аннотации):
@Component
@Aspect
@RequiredArgsConstructor
public class SalesAspect {
    private final SalesObserver salesObserver;

    @Around("@annotation(sales)")
    public Object sales(ProceedingJoinPoint pjp, Sales sales) throws Throwable 
    {
        //TODO ваш код
    } 
};
```

## Тестирование
- При продаже автомобиля - запись появляется в отчете
- При продаже катамарана - запись появляется в отчете
- Все данные клиента и товара сохраняются корректно
- Отчет формируется автоматически без ручного вмешательства

## Критерии оценки
- [ ] Паттерн Наблюдатель реализован корректно
- [ ] Отчет формируется автоматически при каждой продаже
- [ ] Все данные сохраняются полностью и правильно
- [ ] АОП настроено и отслеживает операции
- [ ] Код чистый и хорошо структурирован

<details>
<summary>Подсказки по реализации</summary>

- Начинайте с создания интерфейса наблюдателя
- Реализуйте механизм подписки в классе продаж
- Добавьте вызов оповещения в методы продаж
- Настройте аспект для автоматического отслеживания
- Тестируйте каждый шаг
</details>

<details> 
<summary>Ссылки</summary>
1. https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-aop
2. https://bool.dev/blog/detail/gof-design-patterns
3. https://skillbox.ru/media/base/kak-napisat-annotatsiyu-na-java-za-5-shagov/
</details>