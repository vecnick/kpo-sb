### **Задание: Система экспорта отчетов**

#### **Цель занятия**
Разработать гибкий модуль для экспорта бизнес-отчетов в различные форматы. В ходе работы вы научитесь:
*   Применять принципы чистой архитектуры, разделяя логику домена, экспорта и отображения.
*   Использовать паттерн "Фабрика" для создания семейства связанных объектов.
*   Работать с внешними библиотеками для сериализации данных (Jackson).
*   Практиковаться в записи данных в файлы и потоки.

#### **Постановка задачи**
Вам необходимо расширить существующую систему продаж, добавив возможность формирования текстовых отчетов в форматах **JSON** и **MARKDOWN**. 
Отчет должен генерироваться на основе данных о продажах и записываться в предоставленный поток вывода (например, в файл или консоль).

Ключевая идея: система должна быть легко расширяемой. Добавление нового формата отчета в будущем не должно требовать изменения существующей логики приложения.

---

### **Требования к реализации**

#### **1. Доменная модель (ядро приложения)**
Вам нужно описать доменную сущность `Report`. **Продумайте её структуру самостоятельно**, исходя из того, что отчет должен содержать:
*   Заголовок.
*   Содержимое (например, список проданных товаров, итоговая выручка, дата формирования и т.д.).

**Условный интерфейс:**
```java
// Ваш доменный класс. Структуру полей и методов определяете вы. Ниже возможный пример.
public record Report(String title, String content) {
    // ... ваши поля, конструкторы, геттеры.
    @Override
    public String toString(){
        //TODO код
    };
}
```

#### **2. Интерфейс экспортера**
Это контракт, который будут реализовывать все экспортеры. Он не зависит от формата.

```java

import your.project.domain.Report;
import java.io.IOException;
import java.io.Writer;

public interface ReportExporter {
    /**
     * Экспортирует переданный отчет в заданный формат и записывает его в Writer.
     *
     * @param report доменный объект отчета
     * @param writer поток для записи результата (файл, консоль и т.д.)
     * @throws IOException если в процессе записи произошла ошибка
     */
    void export(Report report, Writer writer) throws IOException;
}
```

#### **3. Реализация экспортеров (Ваша задача!)**
Вам нужно создать две реализации интерфейса `ReportExporter`:

*   **`JsonReportExporter`**: Для преобразования отчета в JSON.
*   **`MarkdownReportExporter`**: Для преобразования отчета в текст с разметкой Markdown.

**Рекомендации:**
*   Для `JsonReportExporter` используйте библиотеку **Jackson**. Добавьте её в `build.gradle`:
    ```gradle
    implementation("com.fasterxml.jackson.core:jackson-databind:2.18.2")
    ```
    *Подсказка: Вам потребуется класс `ObjectMapper`.*
*   Для `MarkdownReportExporter` реализуйте логику форматирования текста самостоятельно, используя правила Markdown (например, `# ` для заголовка, `- ` для элементов списка).

#### **4. Фабрика экспортеров**
Создайте фабрику, которая будет возвращать нужную реализацию экспортера в зависимости от запрошенного формата.

**Вспомогательное перечисление:**
```java
public enum ReportFormat {
    JSON,
    MARKDOWN
}
```

**Условный интерфейс фабрики:**
```java
package your.project.factories;

import your.project.export.ReportExporter;
import your.project.enums.ReportFormat;

public class ReportExporterFactory {
    /**
     * Создает экспортер для указанного формата.
     *
     * @param format формат отчета (JSON, MARKDOWN)
     * @return реализацию интерфейса ReportExporter
     * @throws IllegalArgumentException если передан неподдерживаемый формат
     */
    public ReportExporter create(ReportFormat format) {
        // Ваша реализация здесь!
        // Используйте switch для выбора между JsonReportExporter и MarkdownReportExporter.
    }
}
```

#### **5. Интеграция в основную логику**
Вам необходимо внедрить функциональность экспорта в главный сервис приложения и проверить в тесте формирование отчета.

Добавить использование в главный тест:

```
// Экспорт в консоль в формате Markdown
hse.exportReport(ReportFormat.MARKDOWN, new PrintWriter(System.out));

// Экспорт в файл в формате MARKDOWN
try (FileWriter fileWriter = new FileWriter("report.MD")) {
hse.exportReport(ReportFormat.MARKDOWN, fileWriter);
}

// Экспорт в файл в формате JSON
try (FileWriter fileWriter = new FileWriter("report.json")) {
hse.exportReport(ReportFormat.JSON, fileWriter);
}
```

---

### **Критерии успешного выполнения и тестирование**

1.  **Компиляция и запуск:** Код компилируется без ошибок.
2.  **Работа экспорта:**
    *   При вызове `exportReport(ReportFormat.JSON, writer)` в поток `writer` записывается валидный JSON, корректно представляющий данные отчета.
    *   При вызове `exportReport(ReportFormat.MARKDOWN, writer)` в поток `writer` записывается читаемый текст, отформатированный по правилам Markdown.
3.  **Гибкость архитектуры:** Добавление в будущем нового формата (например, XML) потребует только создания нового класса-экспортера и обновления фабрики, без изменения кода в фасаде.
4.  **Формирование файлов:** После выполнения программы в корне проекта (или в указанной директории) должны создаваться файлы `report.json` и `report.md` с корректным содержимым.

---

**Удачи в реализации! Помните, что чистая архитектура и четкое разделение ответственности — залог успешного и поддерживаемого кода.**